- block:
    - name: Mirror repository locally
      shell: "reposync -l -n -p /var/ftp/pub/{{ repo_folder }}/ > /dev/null"
      tags:
        - sync_mirror

    - name: Create repositories from local mirror
      shell: "for DIR in `find /var/ftp/pub/{{ repo_folder }}  -maxdepth 1 -mindepth 1 -type d`; do createrepo $DIR; done; > /dev/null"

    - name: Execute repository creation script
      script: "./scripts/create_repo.sh {{ repo_folder }} {{repo_name}}"
  become: true
